import React, { Component } from 'react';
import PropTypes from "prop-types";
import { AllHtmlEntities } from 'html-entities';

const entities = new AllHtmlEntities();

class Textarea extends Component {

    componentDidUpdate = (prevProps) => {
        if (this.props.view !== prevProps.view) {
            this.contentEditable.current.innerHTML = this.props.view ?
                entities.decode(this.contentEditable.current.innerHTML)
                : entities.encode(this.contentEditable.current.innerHTML)
        }
    }

    componentDidMount = () => {
        if (this.props.initialContent) {
            this.contentEditable.current.innerHTML = entities.decode(this.props.initialContent)
        }


        window.addEventListener('paste', e => {
            e.preventDefault();
            const text = (e.originalEvent || e).clipboardData.getData('text/plain');
            document.execCommand("insertHTML", false, text);
        });
    }

    contentEditable = React.createRef(null);

    render() {
        const { view, getState } = this.props;
        const classNames = ['mdb-wysiwyg-textarea']
        !view && classNames.push('show-raw');

        return (
            <div className={classNames.join(" ")} ref={this.contentEditable} contentEditable onClick={view ? getState : undefined} onKeyPress={view ? getState : undefined} />
        )
    }

}


Textarea.propTypes = {
    view: PropTypes.bool.isRequired,
    getState: PropTypes.func.isRequired,
    initialContent: PropTypes.string
}

export default Textarea
