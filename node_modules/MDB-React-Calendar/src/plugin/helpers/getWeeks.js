import { startOfWeek, startOfMonth, endOfWeek, endOfMonth, isBefore, addDays } from 'date-fns';

export default function getWeeks(date, wholeMonth = false) {
  const start = wholeMonth ? startOfWeek(startOfMonth(date)) : startOfWeek(date);
  const end = wholeMonth ? endOfWeek(endOfMonth(date)) : endOfWeek(date);

  return addDayToWeek(0, [], start, end, wholeMonth);
};

function addDayToWeek(count, weeks, current, end, wholeMonth) {
  if (isBefore(current, end)) {
    const weekNumber = Math.floor(count / 7);
    weeks[weekNumber] = weeks[weekNumber] || { days: [], tasks: [] };
    weeks[weekNumber].days.push(current);

    addDayToWeek(count + 1, weeks, addDays(current, 1), end, wholeMonth);
  }

  if (weeks.length < 6 && wholeMonth) {
    addDayToWeek(count, weeks, current, endOfWeek(addDays(end, 1)), wholeMonth);
  }

  return weeks;
}